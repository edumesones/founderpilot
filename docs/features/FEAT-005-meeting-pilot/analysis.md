# FEAT-005: MeetingPilot - Critical Analysis

> Generated by Think Critically protocol (Phase 2 of Feature Cycle)
> **Depth:** Medium (steps 1-2-3-5-9-11)
> **Reason:** Feature nueva con patrones existentes (InboxPilot ya implementado)
> **Date:** 2026-02-02

---

## 1. Problem Clarification

### Problem Statement
Founders llegan a meetings sin contexto sobre participantes, historial de comunicacion, o compromisos pendientes, causando perdida de tiempo y oportunidades.

### Hard Constraints
- Solo Google Calendar (Outlook es v1.1+)
- Slack como unico canal de notificacion (consistente con otros agentes)
- 30 meetings/mes limite en plan individual

### Soft Constraints
- Brief 30 min antes es default (configurable)
- Solo meetings con participantes externos por default

### Success Criteria
- 90% de meetings externos reciben brief a tiempo
- Reduccion de 15 min de prep manual por meeting
- 80% de meetings tienen notas post-meeting capturadas
- NPS > 40 de usuarios activos

### Non-Goals
- Scheduling/booking de meetings
- Transcripcion de audio/video
- Integracion con Zoom/Meet/Teams
- CRM completo (solo contexto para meetings)

---

## 2. Implicit Assumptions

| # | Assumption | If Wrong, Impact | Confidence | Category |
|---|------------|------------------|------------|----------|
| A1 | Usuario tiene meetings en Google Calendar | Sin meetings = agente inutil | High | Integration |
| A2 | Usuario usa Gmail para comunicacion con participantes | Brief sin contexto email | Medium | Integration |
| A3 | 30 min es suficiente anticipacion | Usuario no preparado | Medium | UX |
| A4 | Participantes tienen email parseable del calendar event | No identificamos participantes | High | Data |
| A5 | InboxPilot ya proceso emails relevantes (email_records existe) | Query lento a Gmail API | Medium | Integration |
| A6 | Usuario revisa Slack regularmente | Briefs ignorados | High | UX |
| A7 | Meetings externos son los importantes | Briefs para meetings internos ignorados | Medium | Business |

### Assumptions Requiring Validation

- [ ] **A2 - Gmail como fuente de contexto** (Medium confidence, High impact)
  - Mitigacion: Brief parcial indica "Primer contacto" si no hay emails
  - No bloquea desarrollo

- [ ] **A5 - Dependencia de email_records** (Medium confidence, Medium impact)
  - Mitigacion: Query directo a Gmail API como fallback
  - No bloquea desarrollo

**No hay asunciones Low confidence + High impact. Proceder es seguro.**

---

## 3. Design Space Exploration

### Approach A: LangGraph Agent (como InboxPilot)
**Core idea:** Agent con StateGraph que sincroniza calendar, genera briefs, y captura notas
**Pros:**
- Consistente con arquitectura existente
- Human-in-loop nativo
- Checkpointing para estado persistente
- Auditable por diseno
**Cons:**
- Mayor complejidad que servicio simple
- Mas estado que mantener
**Best when:** Feature compleja con interaccion humana
**Effort:** Medium

### Approach B: Servicio Simple (sin agent)
**Core idea:** Cron job que genera briefs y los envia a Slack
**Pros:**
- Mas simple de implementar
- Menos overhead
**Cons:**
- No hay punto de interrupcion para human-in-loop
- Menos flexible para flujo post-meeting
- Inconsistente con InboxPilot
**Best when:** Feature simple sin interaccion
**Effort:** Low

### Approach C: Webhook Reactivo
**Core idea:** Calendar push notifications triggean brief generation
**Pros:**
- Baja latencia para nuevos eventos
- Event-driven
**Cons:**
- Webhooks pueden fallar silenciosamente
- Requiere fallback de polling de todas formas
- Complejidad de setup
**Best when:** Real-time es critico
**Effort:** Medium-High

### Preliminary Recommendation
**Approach A: LangGraph Agent** - Consistente con InboxPilot, permite human-in-loop para notas post-meeting, y es auditable. La complejidad adicional se justifica por la consistencia arquitectonica.

---

## 5. Failure-First Analysis

### Critical Failures (High Severity)

| Failure Mode | Probability | Severity | Detection | Mitigation |
|--------------|-------------|----------|-----------|------------|
| Calendar OAuth token expirado | Medium | High | 401 error | Re-auth flow, notificar usuario |
| Database no disponible | Low | High | Connection error | Retry 3x, circuit breaker |
| Brief llega tarde (meeting ya empezo) | Medium | High | timestamp > meeting start | Webhook + polling, procesamiento inmediato |

### Likely Failures (High Probability)

| Failure Mode | Probability | Severity | Detection | Mitigation |
|--------------|-------------|----------|-----------|------------|
| Participante sin historial de emails | High | Low | Query returns empty | Brief indica "Primer contacto" |
| Usuario no responde a brief | High | Low | No action within window | Log, no action required |
| Meeting cancelado despues de brief | Medium | Low | Calendar event deleted | Notificar cancelacion |
| Rate limit de Calendar API | Medium | Medium | 429 error | Exponential backoff, cache |

### Cascading Failures
- Si **Calendar sync falla** → No detectamos meetings → No enviamos briefs → Usuario desprotegido
- Si **Gmail access falla** → Briefs sin contexto → Valor reducido → User churn

---

## 9. Adversarial Review

### Over-engineering Concerns
- **Agent para feature relativamente simple**: Justificado por consistencia con InboxPilot y necesidad de human-in-loop para notas

### Under-engineering Concerns
- **Sin webhook de calendar**: Polling cada 15 min puede perder meetings creados con poca anticipacion
  - Solucion: Implementar Google Calendar Watch API para push notifications

### The 2AM Incident
- **Scenario**: Calendar sync job falla silenciosamente durante 12 horas
- **Impact**: Todos los meetings del dia sin brief
- **Prevention**: Health check endpoint, alertas si no hay syncs en 30 min

### Future Pain Points
- **Multiples calendarios**: Solo soportamos 1 calendario por ahora
- **Outlook support**: Requerira refactor significativo de integracion

### Security Concerns
- **Email content en brief**: No copiar contenido, solo resumir
- **Brief a channel compartido**: Solo DM al usuario, nunca channels

### Scale Concerns
- **Usuario con 50 meetings/dia**: Sobrecarga de briefs
- **Solucion**: Configuracion para filtrar (solo externos, solo > 2 personas)

### Red Flags Found
- **RF1 (Medium)**: Sin webhook de calendar - briefs pueden llegar tarde
  - Mitigacion: Implementar Watch API, no bloquea MVP
- **RF2 (Low)**: Sin deduplicacion de events
  - Mitigacion: Deduplicar por event_id

**No hay red flags criticos. Proceder es seguro.**

---

## 11. Decision Summary

### Recommended Approach
**LangGraph Agent siguiendo patron de InboxPilot:**
- Consistente con arquitectura existente
- Human-in-loop para captura de notas
- Checkpointing para estado persistente
- Auditoria automatica

### Key Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Architecture | LangGraph Agent | Consistencia con InboxPilot |
| Calendar sync | Polling 15 min + webhook | Reliability + freshness |
| Brief timing | 30 min antes (configurable) | Balance prep time vs noise |
| Context source | Gmail emails (ultimos 5) | Disponible via FEAT-001 OAuth |
| Notification | Slack DM only | Privacidad, consistencia |
| LLM model | Claude Haiku (default) | Costo-eficiente para resumen |

### Short-term Goals (This Implementation)
1. Calendar sync funcional con Google Calendar API
2. Brief generation con contexto de emails
3. Notificacion Slack 30 min antes
4. Captura de notas post-meeting
5. Audit log de todas las acciones

### Long-term Considerations
- Outlook/Exchange support (v1.1)
- Multiple calendars per user
- AI learning from brief feedback
- Integracion con transcription services

### Remaining Unknowns
- [ ] **Calendar Watch API setup**: Investigar durante implementacion
- [ ] **Email relevance scoring**: Empezar simple (recientes), mejorar con feedback

### Security Threat Model

| Threat | Likelihood | Impact | Mitigation |
|--------|------------|--------|------------|
| Brief leak to shared channel | Low | High | Only send to DM |
| Stale OAuth token | Medium | Medium | Token refresh flow |
| Email content exposure | Medium | Medium | Summarize, dont copy |

### Blast Radius Analysis
- Si **MeetingPilot falla**: Solo este agente afectado, otros funcionan
- Si **Calendar integration falla**: Solo MeetingPilot afectado
- Maximum blast radius: Un usuario pierde briefs, no afecta otros usuarios

### Confidence Level
**Medium-High** - Patron probado (InboxPilot), integracion nueva (Calendar) pero API bien documentada.

### Red Flags to Watch
- Webhook de calendar fallando silenciosamente
- Briefs llegando consistentemente tarde
- Usuarios ignorando briefs (bajo engagement)

### Recommended Next Steps
1. **Proceder a Plan phase** - No hay blockers
2. Crear design.md con arquitectura de componentes
3. Crear tasks.md con checklist detallado

---

## How This Analysis Feeds the Plan Phase

| Section | Plan Phase Usage |
|---------|-------------------|
| Recommended Approach (11) | Architecture: LangGraph agent pattern |
| Failure Mitigations (5) | Error handling tasks: retry, circuit breaker |
| Boundaries (n/a - abbreviated) | Validation: 30 meetings/month limit |
| Observability (n/a - abbreviated) | Monitoring: sync health, brief delivery |
| Trade-off Positions (n/a - abbreviated) | Polling + webhook hybrid |

---

*Generated: 2026-02-02*
*Protocol: Medium (steps 1-2-3-5-9-11)*
*Confidence: Medium-High*
*Red flags: 0 critical, 2 minor*
*Next phase: Plan - `/plan implement FEAT-005`*
